{
is_strict: true,
id: "ivan",
prototype: ["hittable"],
is_human: true,
editor_info: { category: "player" },
zorder: "@include data/zorder.cfg:player",

collide_dimensions: ["player","enemy","hazard"],

//--------------------- init ---------------------------
on_create: "animation('stand')",

//--------------------- properties ---------------------------
properties: {
  // Sets new animation, but returns the previous one
  // (useless now, only useful for debug output)
  _animation: { variable: true, type: "string", default: "stand", get: "_data",
                 set: "[set(_data, animation), animation(value),
//                   debug(_data+'->'+animation),
                   ]",
              },
  //--------------------- Constants ---------------------------
  jump_power: "int :: 1200",
  jump_ctrl_x: "int :: 25",
  jump_ctrl_y: "int :: 50",
},

//--------------------- events ---------------------------
on_collide_feet: "[set(velocity_y, 0),
  if(animation not in ['hit','jumphit'], animation('stand'))
]",

on_collide_damage: "debug('on_collide_damage: '+type+' '+cycle)",
on_collide_object_body: "debug('on_collide_object_body: '+type+' '+arg.collide_with.type+' '+cycle)",

//--------------------- anim control ---------------------------
on_change_animation_failure: "animation(arg.previous_animation)",

on_end_stand_anim: "animation('stand')",
on_end_walk_anim: "animation('walk')",
on_end_walkstop_anim: "animation('stand')",
on_end_hit_anim: "animation('stand')",
on_end_jumphit_anim: "animation(if(velocity_y>0, 'fall', if(velocity_y<0, 'jump', 'stand')))",
on_end_jump_anim: "animation('fall')",

//--------------------- on control ---------------------------
on_ctrl_tongue: "if(animation not in ['hit','jumphit'],
  if(animation in ['jump','fall'], animation('jumphit'), animation('hit')))",

on_ctrl_jump: "if(animation in ['stand','walk','walkstop'], [
  animation('jump'), set(velocity_y, -jump_power)
//  add(velocity_x, velocity_x),
  ])",

on_ctrl_attack: "debug('on_ctrl_attack')",
on_ctrl_left: "",
on_ctrl_right: "",
on_ctrl_up: "",
on_ctrl_down: "",

//--------------------- on process ---------------------------
on_process: "[
  if((ctrl_left or ctrl_right) and animation in ['stand','walkstop'], animation('walk')),
  if(animation in ['jump','fall'],
    [if(ctrl_left, [set(facing, -1), add(velocity_x, -jump_ctrl_x)],
      if(ctrl_right, [set(facing, 1), add(velocity_x, jump_ctrl_x)]))],
    //fall from ledge
    if((not is_standing) and animation != 'jumphit', animation('fall'))
  ),
//  debug display
//  if(cycle%5=0, [debug('accel_x:'+accel_x+' velocity_x:'+velocity_x)]),
]",
on_process_walk: "if(ctrl_left or ctrl_right, set(facing, if(ctrl_left, -1, 1)), animation('walkstop'))",
on_process_jump: "if(ctrl_jump, [add(velocity_y, -jump_ctrl_y)])", //jump higher when button is hold
on_process_fall: "if(time_in_animation=20, set(time_in_animation, 10))", //loop falling frames


//--------------------- animations ---------------------------
animation: [
  {
    "@base": true,
    image: "characters/ivan.png",
    pad: 3,
    reverse: false,
    accel_y: 80,
//    rotate_on_slope: true,
//    attack_area: "all",
//    body_area: "all",
  },
  {
    id: "stand",
    rect: [1,1,20,41],
    solid_area: [1,2,15,40],
    body_area:  [1,2,15,40],
    duration: 6,
    frames: 5,
    accel_x: 0,
  },
  {
    id: "walk",
    rect: [1,45,29,85],
    solid_area: [9,2,23,40],
    body_area:  [9,2,23,40],
    duration: 3,
    frames: 10,
    accel_x: 1500,
  },
  {
    id: "walkstop",
    rect: [119,1,144,41],
    solid_area: [4,2,18,40],
    body_area:  [4,2,18,40],
    duration: 4,
    frames: 4,
    accel_x: 0,
  },
  {
    id: "hit",
    rect: [1,89,35,129],
    solid_area: [2,2,16,40],
    body_area:  [2,2,16,40],
    duration: 3,
    frames: 4,
    attack_area: [17,15,35,20],
    accel_x: 0,
  },
  {
    id: "jumphit",
    rect: [1,180,35,222],
    solid_area: [2,2,16,40],
    body_area:  [2,2,16,40],
    duration: 3,
    frames: 4,
    attack_area: [17,14,35,19],
  },
  {
    id: "jump",
    rect: [1,133,32,176],
    solid_area: [8,3,22,41],
    body_area:  [8,3,22,41],
    duration: 5,
    frames: 3,
  },
  {
    id: "fall",
    rect: [36,133,67,176],
    solid_area: [8,3,22,41],
    body_area:  [8,3,22,41],
    duration: 5,
    frames: 4,
  },

],

}
