{
is_strict: true,
id: "ivan",
is_human: true,
editor_info: { category: "ivan" },
zorder: "@include data/zorder.cfg:player",
friction: 2000,
traction_in_water: 1000,
affected_by_currents: true,


properties: {
  // Sets new animation, but returns the previous one
  _animation: { variable: true, type: "string", default: "stand", get: "_data",
                 set: "[set(_data, animation), animation(value),
//                   debug(_data+'->'+animation),
                   ]",
              },
  _jump_power: 1200,
},
on_change_animation_failure: "animation(arg.previous_animation)",

on_collide_feet: "[debug('collide_feet'), set(velocity_y, 0), set(_animation, 'stand')]",

on_ctrl_tongue: "if(animation not in ['hit','jumphit'], if(animation in ['jump','fall'], set(_animation, 'jumphit'), set(_animation, 'hit')))",

on_end_stand_anim: "set(_animation, 'stand')",
on_end_walk_anim: "set(_animation, 'walk')",
on_end_walkstop_anim: "set(_animation, 'stand')",
on_end_hit_anim: "set(_animation, 'stand')",
on_end_jumphit_anim: "set(_animation, _animation)", // set previous animation (jump or fall)
on_end_jump_anim: "[debug('fall'), set(_animation, 'fall')]",
on_end_fall_anim: "set(_animation, 'fall')",

on_ctrl_jump: "if(animation in ['stand','walk','walkstop'], [
  set(_animation, 'jump'),
//  add(velocity_x, velocity_x),
//  set(velocity_y, -_jump_power)
  ])",

on_ctrl_attack: "debug('attack')",
on_ctrl_left: "[debug('left')]",
on_ctrl_right: "[debug('right')]",
on_ctrl_up: "debug('up')",
on_ctrl_down: "debug('down')",

on_process: "if(cycle%2=0, [
  if((ctrl_left or ctrl_right) and animation in ['stand','walkstop'], set(_animation, 'walk')),
  if(animation in ['jump','fall'],[
    if(ctrl_left, [set(facing, -1), add(velocity_x, -50)],
      if(ctrl_right, [set(facing, 1), add(velocity_x, 50)]))]),
//  debug display
//  if(cycle%5=0, [debug('accel_x:'+accel_x+' velocity_x:'+velocity_x)]),
])",
on_process_walk: "if(ctrl_left or ctrl_right, set(facing, if(ctrl_left, -1, 1)), set(_animation, 'walkstop'))",
on_process_jump: "if(ctrl_jump, [add(velocity_y, -50)])",


animation: [
  {
    id: "stand",
    image: "characters/ivan.png",
    rect: [1,1,20,41],
    solid_area: [1,2,15,40],
    pad: 3,
    duration: 6,
    frames: 5,
    reverse: false,
    accel_y: 80,
    accel_x: 0,
  },
  {
    id: "walk",
    image: "characters/ivan.png",
    rect: [1,45,29,85],
    solid_area: [9,2,23,40],
    pad: 3,
    duration: 3,
    frames: 10,
    reverse: false,
    accel_y: 80,
    accel_x: 1500,
  },
  {
    id: "walkstop",
    image: "characters/ivan.png",
    rect: [119,1,144,41],
    solid_area: [4,2,18,40],
    pad: 3,
    duration: 4,
    frames: 4,
    reverse: false,
    accel_y: 80,
    accel_x: 0,
  },
  {
    id: "hit",
    image: "characters/ivan.png",
    rect: [1,89,35,129],
    solid_area: [2,2,16,40],
    pad: 3,
    duration: 3,
    frames: 4,
    reverse: false,
    accel_y: 80,
  },
  {
    id: "jumphit",
    image: "characters/ivan.png",
    rect: [1,180,35,222],
    solid_area: [2,2,16,40],
    pad: 3,
    duration: 3,
    frames: 4,
    reverse: false,
    accel_y: 30,
  },
  {
    id: "jump",
    image: "characters/ivan.png",
    rect: [1,133,32,176],
    solid_area: [8,3,22,41],
    pad: 3,
    duration: 5,
    frames: 2,
    reverse: false,
    accel_y: 80,
    velocity_y: -1200,
  },
  {
    id: "fall",
    image: "characters/ivan.png",
    rect: [36,133,67,176],
    solid_area: [8,3,22,41],
    pad: 3,
    duration: 5,
    frames: 2,
    reverse: false,
    accel_y: 80,
  },

],

}
