{
is_strict: true,
id: "ivan",
is_human: true,
editor_info: { category: "ivan" },
zorder: "@include data/zorder.cfg:player",
friction: 2000,
traction_in_water: 1000,
affected_by_currents: true,

properties: {
  // Sets new animation, but returns the previous one
  // (useless now, only useful for debug output)
  _animation: { variable: true, type: "string", default: "stand", get: "_data",
                 set: "[set(_data, animation), animation(value),
//                   debug(_data+'->'+animation),
                   ]",
              },
  _jump_power: "int :: 1200",
  _jump_ctrl_vel_x: "int :: 50",
  _jump_ctrl_vel_y: "int :: 50",
},
on_change_animation_failure: "animation(arg.previous_animation)",

on_collide_feet: "[debug('collide_feet'), set(velocity_y, 0), set(_animation, 'stand')]",

on_ctrl_tongue: "if(animation not in ['hit','jumphit'], if(animation in ['jump','fall'], set(_animation, 'jumphit'), set(_animation, 'hit')))",

on_end_stand_anim: "set(_animation, 'stand')",
on_end_walk_anim: "set(_animation, 'walk')",
on_end_walkstop_anim: "set(_animation, 'stand')",
on_end_hit_anim: "set(_animation, 'stand')",
on_end_jumphit_anim: "set(_animation, if(accel_y>=0, 'fall', 'jump'))", // set previous animation (jump or fall)
on_end_jump_anim: "[debug('fall'), set(_animation, 'fall')]",

on_ctrl_jump: "if(animation in ['stand','walk','walkstop'], [
  set(_animation, 'jump'),
  set(velocity_y, -_jump_power)
//  add(velocity_x, velocity_x),
  ])",

on_ctrl_attack: "debug('attack')",
on_ctrl_left: "[debug('left')]",
on_ctrl_right: "[debug('right')]",
on_ctrl_up: "debug('up')",
on_ctrl_down: "debug('down')",

on_process: "if(cycle%2=0, [
  if((ctrl_left or ctrl_right) and animation in ['stand','walkstop'], set(_animation, 'walk')),
  if(animation in ['jump','fall'],
    [if(ctrl_left, [set(facing, -1), add(velocity_x, -_jump_ctrl_vel_x)],
      if(ctrl_right, [set(facing, 1), add(velocity_x, _jump_ctrl_vel_x)]))],
    //fall from ledge
    if((not is_standing) and animation != 'jumphit', set(_animation, 'fall'))
    ),
//  debug display
//  if(cycle%5=0, [debug('accel_x:'+accel_x+' velocity_x:'+velocity_x)]),
])",
on_process_walk: "if(ctrl_left or ctrl_right, set(facing, if(ctrl_left, -1, 1)), set(_animation, 'walkstop'))",
on_process_jump: "if(ctrl_jump, [add(velocity_y, -_jump_ctrl_vel_y)])", //jump higher when button is hold
on_process_fall: "if(time_in_animation=20, set(time_in_animation, 10))", //loop falling frames


animation: [
	{
		"@base": true,
    image: "characters/ivan.png",
		pad: 3,
    reverse: false,
		accel_y: 80,
#    rotate_on_slope: true,
#    body_area: "all",
#    attack_area: "all",
	},
  {
    id: "stand",
    rect: [1,1,20,41],
    solid_area: [1,2,15,40],
    duration: 6,
    frames: 5,
    accel_x: 0,
  },
  {
    id: "walk",
    rect: [1,45,29,85],
    solid_area: [9,2,23,40],
    duration: 3,
    frames: 10,
    accel_x: 1500,
  },
  {
    id: "walkstop",
    rect: [119,1,144,41],
    solid_area: [4,2,18,40],
    duration: 4,
    frames: 4,
    accel_x: 0,
  },
  {
    id: "hit",
    rect: [1,89,35,129],
    solid_area: [2,2,16,40],
    duration: 3,
    frames: 4,
    attack_area: [17,15,35,20],
  },
  {
    id: "jumphit",
    rect: [1,180,35,222],
    solid_area: [2,2,16,40],
    duration: 3,
    frames: 4,
    attack_area: [17,14,35,19],
  },
  {
    id: "jump",
    rect: [1,133,32,176],
    solid_area: [8,3,22,41],
    duration: 5,
    frames: 3,
  },
  {
    id: "fall",
    rect: [36,133,67,176],
    solid_area: [8,3,22,41],
    duration: 5,
    frames: 4,
  },

],

}
